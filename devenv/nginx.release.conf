# Harbor reverse proxy â€” drop into /etc/nginx/conf.d/
# The base nginx.conf (baked into the image) handles pid/temp paths for non-root.

client_max_body_size 0;
proxy_buffering off;
proxy_request_buffering off;
proxy_next_upstream error timeout http_502 http_503 http_504;
proxy_next_upstream_timeout 30;
proxy_next_upstream_tries 5;

server {
    listen 8080;

    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

    location /v2/ {
        proxy_pass http://core:8080;
        proxy_send_timeout 900;
        proxy_read_timeout 900;
    }

    location /api/ {
        proxy_pass http://core:8080;
    }

    location /service/ {
        proxy_pass http://core:8080;
    }

    location /c/ {
        proxy_pass http://core:8080;
        proxy_send_timeout 900;
        proxy_read_timeout 900;
    }

    location / {
        proxy_pass http://portal:8080;
    }
}
